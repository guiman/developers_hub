<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_API_KEY'] %>"></script>
<div id="map-canvas" style="height: 350px;"></div>
<script>

function initialize() {
  var myLatlng = new google.maps.LatLng(50.9167536,-1.4004929);
  var mapOptions = {
    zoom: 8,
    center: myLatlng//,
    //styles: [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]}]
  };

  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  $(function() {
    $.get( "/map_data/<%= @language %>", function(data) {
      for(i = 0; i < data.length; i++) {
        var lat = data[i].position[0];
        var lng = data[i].position[1];
        var developer_count = data[i].language_count;
        var position = new google.maps.LatLng(lat, lng);
        var content = 'Devs found: ' + developer_count + '<br /><a target="_blank" href="/map/' + lat + '/' + lng + '/<%= @language %>">Listing</a>';
        addMarker(map, position, developer_count, content);
      }
    });
  });

}

google.maps.event.addDomListener(window, 'load', initialize);

function addMarker(map, position, developer_count, contentString) {
    var marker = new google.maps.Marker({
        position: position,
        map: map,
        title: 'Developers (' + developer_count + ')'
    });
    var infowindow = new google.maps.InfoWindow({
        content: contentString,
        disableAutoPan : true
    });
    // var marker = new google.maps.Circle({
    //   map: map,
    //   center: position,
    //   radius: developer_count * 50,
    //   strokeColor: '#FF0000',
    //   strokeOpacity: 0.8,
    //   fillColor: '#f03',
    //   fillOpacity: 0.3
    // });
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
    });
}

</script>


<%= render partial: "shared/users_data", locals: { candidates: @candidates, language: @language } %>
